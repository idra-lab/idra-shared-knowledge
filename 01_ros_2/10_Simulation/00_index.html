<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Linux and other Utilities" href="../../02_linux/00_index.html" /><link rel="prev" title="Workspaces and Packages" href="../02_Packages/00_index.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>Simulation Setup - IDRA laboratory - Open Knowledge documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">IDRA laboratory - Open Knowledge  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">IDRA laboratory - Open Knowledge  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../00_index.html">ROS2 Notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of ROS2 Notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01_CLI/00_index.html">CLI Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_Packages/00_index.html">Workspaces and Packages</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Simulation Setup</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02_linux/00_index.html">Linux and other Utilities</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Linux and other Utilities</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_linux/02_docker/00_index.html">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_linux/03_github_actions/00_index.html">Github Actions for CI/CD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_linux/10_coppelia/00_index.html">Coppelia Simulator</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="simulation-setup">
<span id="simulation-setup-example"></span><h1>Simulation Setup<a class="headerlink" href="#simulation-setup" title="Link to this heading">#</a></h1>
<p>Setting up a simulation requires a lot of different nodes that interact with each other.
The following is a graph showing nodes (and associated relationships) used in a simulation.</p>
digraph G {
   rankdir=LR;
   &quot;/controller_manager&quot;;
   &quot;/motion_control_handle&quot;     -&gt; &quot;/cartesian_motion_controller&quot;   [label=&quot;/target_frame&quot;];
   &quot;/joint_state_broadcaster&quot;   -&gt; &quot;/robot_state_publisher&quot;         [label=&quot;/joint_states&quot;];
   &quot;/robot_state_publisher&quot;     -&gt; &quot;/transform_listener_impl_&lt;#1&gt;&quot;  [label=&quot;/tf_static&quot;];
   &quot;/robot_state_publisher&quot;     -&gt; &quot;/transform_listener_impl_&lt;#1&gt;&quot;  [label=&quot;/tf&quot;];
   &quot;/sim_ros2_interface&quot;        -&gt; &quot;/transform_listener_impl_&lt;#1&gt;&quot;  [label=&quot;/tf&quot;];
   &quot;/sim_ros2_interface&quot;        -&gt; &quot;/robot_controller&quot;              [label=&quot;/coppelia_joint_joints&quot;];
   &quot;/robot_controller&quot;          -&gt; &quot;/sim_ros2_interface&quot;            [label=&quot;/coppelia_set_joints&quot;];
}
<section id="node-description">
<h2>Node description<a class="headerlink" href="#node-description" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">/joint_state_broadcaster</span></code> node is part of the <a class="reference external" href="https://control.ros.org/humble/index.html">ROS2 control package</a>.
More details can be found <a class="reference external" href="https://control.ros.org/humble/doc/ros2_controllers/joint_state_broadcaster/doc/userdoc.html">here</a>,
but essentially the broadcaster reads all state interfaces and reports them on the <code class="docutils literal notranslate"><span class="pre">/joint_states</span></code> topic.</p>
<p>Such data is collected by the <code class="docutils literal notranslate"><span class="pre">/robot_state_publisher</span></code> node (package <a class="reference external" href="https://github.com/ros/robot_state_publisher">Robot State
Publisher</a>) that combines the knowledge of
the robotâ€™s kinematics to publish the full tree of transformations for the different links
on the topics <code class="docutils literal notranslate"><span class="pre">/tf</span></code> and <code class="docutils literal notranslate"><span class="pre">/tf_static</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">/motion_control_handle</span></code> node is still part of ROS2 control, but in this case it
spawns an handle that can be moved in RViz that specifies the target position of the robot;
the information is published on the <code class="docutils literal notranslate"><span class="pre">/target_frame</span></code> topic.</p>
<p>The target is collected by the <code class="docutils literal notranslate"><span class="pre">/cartesian_mototion_controller</span></code> node (generated by the
ROS2 control package but can load any custom controller that implements the
<code class="docutils literal notranslate"><span class="pre">CartesianMotionController</span></code> interface) that computes the commands to be sent to the
robot.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sim_ros2_interface</span></code> node is instead provided by <a class="reference internal" href="../../02_linux/10_coppelia/00_index.html#coppeliasim"><span class="std std-ref">CoppeliaSim</span></a> and
is the bridge between the ROS2 world (in which the control is computed) and the Coppelia
world (in which the system is simulated).</p>
<p>As mentioned <a class="reference external" href="https://robotics.stackexchange.com/questions/104551/how-does-anything-listen-to-tf2-what-are-the-transform-listener-impl-nodes">here</a>,
the <code class="docutils literal notranslate"><span class="pre">/transform_listener_impl_&lt;&gt;</span></code> nodes are automatically spawned in order to ensure
a reliable transformation processing.</p>
<p><strong>Note</strong>: missing the description of the <code class="docutils literal notranslate"><span class="pre">/robot_controller</span></code> node.</p>
<p>Finally, the standalone <code class="docutils literal notranslate"><span class="pre">/controller_manager</span></code> node, from ROS2 control, is the key topic
that needs to be enabled to manage the communication between the different control nodes.</p>
</section>
<section id="launch-file">
<h2>Launch file<a class="headerlink" href="#launch-file" title="Link to this heading">#</a></h2>
<p>Coppelia simulator does not provide a ROS interface to start the simulation itself.
Therefore, the simulator must be started manually (e.g. <code class="docutils literal notranslate"><span class="pre">$COPPELIASIM_ROOT/coppeliaSim.sh</span></code>),
the proper <code class="docutils literal notranslate"><span class="pre">.ttt</span></code> scene must be selected and the simulation enabled.</p>
<p>After that, the ROS2 launch file can be used to start the ROS2 nodes. In the following,
the different section of the launch file are explained in detail; the complete version
of the script can be found <a class="reference internal" href="02b_full_launch_file.html#simulation-launch-file"><span class="std std-ref">here</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xacro</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">ament_index_python.packages</span> <span class="kn">import</span> <span class="n">get_package_share_directory</span>
<span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch.substitutions</span> <span class="kn">import</span> <span class="n">PathJoinSubstitution</span>
<span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">launch_ros.substitutions</span> <span class="kn">import</span> <span class="n">FindPackageShare</span>
</pre></div>
</div>
<p>As usual, first all required packages are imported.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
</pre></div>
</div>
<p>Then its defined the function used by ROS2 that configures and starts all different
required nodes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">share_pkg_dir</span> <span class="o">=</span> <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s2">&quot;ur_coppeliasim&quot;</span><span class="p">)</span>
<span class="n">xacro_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">share_pkg_dir</span><span class="p">,</span> <span class="s2">&quot;urdf&quot;</span><span class="p">,</span> <span class="s2">&quot;ur.urdf.xacro&quot;</span><span class="p">)</span>
<span class="n">available_joint_controllers</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">share_pkg_dir</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;ur_controllers_coppelia.yaml&quot;</span>
    <span class="p">)</span>
<span class="n">declared_arguments</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">use_sim_time</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">ur_type</span> <span class="o">=</span> <span class="s2">&quot;ur3e&quot;</span>
<span class="n">robot_description_content</span> <span class="o">=</span> <span class="n">xacro</span><span class="o">.</span><span class="n">process_file</span><span class="p">(</span>
    <span class="n">xacro_path</span><span class="p">,</span>
    <span class="n">mappings</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;safety_limits&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
        <span class="s2">&quot;safety_pos_margin&quot;</span><span class="p">:</span> <span class="s2">&quot;0.15&quot;</span><span class="p">,</span>
        <span class="s2">&quot;safety_k_position&quot;</span><span class="p">:</span> <span class="s2">&quot;20&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ur&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ur_type&quot;</span><span class="p">:</span> <span class="n">ur_type</span><span class="p">,</span>
        <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s2">&quot;sim_ignition&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sim_gazebo&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
        <span class="s2">&quot;simulation_controllers&quot;</span><span class="p">:</span> <span class="n">available_joint_controllers</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="n">robot_description</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;robot_description&quot;</span><span class="p">:</span> <span class="n">robot_description_content</span><span class="p">}</span>
<span class="n">robot_controllers</span> <span class="o">=</span> <span class="n">available_joint_controllers</span>
</pre></div>
</div>
<p>In this section some relevant resources are loaded. Given the share directory of the
package (that in this case is assumed to be called <em>ur_coppeliasim</em>), the list of availabe
controllers for the controller manager are loaded.
Then, the URDF model is compiled starting from the <em>xacro</em> file of Universal Robots models;
such file contains generic description of all UR models, and in this case the <em>ur3e</em> model
is selected. Important is that both gazebo classic and gazebo ignition are disabled,
since the simulator used is CoppeliaSim.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">control_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">package</span><span class="o">=</span><span class="s2">&quot;controller_manager&quot;</span><span class="p">,</span>
    <span class="n">executable</span><span class="o">=</span><span class="s2">&quot;ros2_control_node&quot;</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
        <span class="n">robot_description</span><span class="p">,</span> <span class="n">robot_controllers</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;use_sim_time&quot;</span><span class="p">:</span> <span class="n">use_sim_time</span>
            <span class="p">}</span>
        <span class="p">],</span>
    <span class="n">output</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
    <span class="n">remappings</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;motion_control_handle/target_frame&#39;</span><span class="p">,</span> <span class="s1">&#39;target_frame&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cartesian_motion_controller/target_frame&#39;</span><span class="p">,</span> <span class="s1">&#39;target_frame&#39;</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>This defines the configuration of the controller manager. Relevant is the configuration
of the <code class="docutils literal notranslate"><span class="pre">use_sim_time</span></code> parameter: in this case it is set to <em>true</em>, to have a synchronization
with the simulator. For instance, simulation might be slower than real time when it becomes
more complex, or in case the simulation is trivial, it can be accelerated.
Furthermore, some topics are remapped for ease of use and sake of demonstration, e.g.
<code class="docutils literal notranslate"><span class="pre">/motion_control_handle/target_frame</span></code> is remapped to <code class="docutils literal notranslate"><span class="pre">/target_frame</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">joint_state_broadcaster_spawner</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">package</span><span class="o">=</span><span class="s2">&quot;controller_manager&quot;</span><span class="p">,</span>
    <span class="n">executable</span><span class="o">=</span><span class="s2">&quot;spawner&quot;</span><span class="p">,</span>
    <span class="n">arguments</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;joint_state_broadcaster&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;/controller_manager&quot;</span><span class="p">],</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[{</span>
        <span class="s2">&quot;use_sim_time&quot;</span><span class="p">:</span> <span class="n">use_sim_time</span>
        <span class="p">}]</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>This configures the joint state broadcaster node, bounding it to the controller manager
defined above. More details of the arguments to use for the controller manager <em>spawner</em>
can be found <a class="reference external" href="https://control.ros.org/humble/doc/ros2_control/controller_manager/doc/userdoc.html#spawner">here</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cartesian_motion_controller_spawner</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">package</span><span class="o">=</span><span class="s2">&quot;controller_manager&quot;</span><span class="p">,</span>
    <span class="n">executable</span><span class="o">=</span><span class="s2">&quot;spawner&quot;</span><span class="p">,</span>
    <span class="n">arguments</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cartesian_motion_controller&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;/controller_manager&quot;</span><span class="p">],</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[{</span>
        <span class="s2">&quot;use_sim_time&quot;</span><span class="p">:</span> <span class="n">use_sim_time</span>
        <span class="p">}]</span>
    <span class="p">)</span>
<span class="c1"># Motion handle</span>
<span class="n">motion_control_handle_spawner</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">package</span><span class="o">=</span><span class="s2">&quot;controller_manager&quot;</span><span class="p">,</span>
    <span class="n">executable</span><span class="o">=</span><span class="s2">&quot;spawner&quot;</span><span class="p">,</span>
    <span class="n">arguments</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;motion_control_handle&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;/controller_manager&quot;</span><span class="p">],</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[{</span>
        <span class="s2">&quot;use_sim_time&quot;</span><span class="p">:</span> <span class="n">use_sim_time</span>
        <span class="p">}]</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Similarly, here the controller manager spawner is used to start the cartesian motion controller,
whose parameters have been loaded in the <code class="docutils literal notranslate"><span class="pre">available_joint_controllers</span></code> variable above.
In the same way, the handle that can be moved from RViz is configured.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">robot_state_publisher</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">package</span><span class="o">=</span><span class="s2">&quot;robot_state_publisher&quot;</span><span class="p">,</span>
    <span class="n">executable</span><span class="o">=</span><span class="s2">&quot;robot_state_publisher&quot;</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="n">robot_description</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;use_sim_time&quot;</span><span class="p">:</span> <span class="n">use_sim_time</span>
        <span class="p">}],</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Here the robot state publisher is loaded.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rviz_config</span> <span class="o">=</span> <span class="n">PathJoinSubstitution</span><span class="p">([</span>
    <span class="n">FindPackageShare</span><span class="p">(</span><span class="s2">&quot;cartesian_controller_simulation&quot;</span><span class="p">),</span> <span class="s2">&quot;etc&quot;</span><span class="p">,</span> <span class="s2">&quot;robot.rviz&quot;</span>
    <span class="p">])</span>
<span class="n">rviz</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">package</span><span class="o">=</span><span class="s2">&quot;rviz2&quot;</span><span class="p">,</span>
    <span class="n">executable</span><span class="o">=</span><span class="s2">&quot;rviz2&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rviz2&quot;</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">arguments</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="n">rviz_config</span><span class="p">],</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[{</span>
        <span class="s2">&quot;use_sim_time&quot;</span><span class="p">:</span> <span class="n">use_sim_time</span>
        <span class="p">}]</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Here RViz is started with a configuration that has been defined in another package,
in particular from <code class="docutils literal notranslate"><span class="pre">cartesian_controller_simulation</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">control_node</span><span class="p">,</span>
    <span class="n">joint_state_broadcaster_spawner</span><span class="p">,</span>
    <span class="n">cartesian_motion_controller_spawner</span><span class="p">,</span>
    <span class="n">motion_control_handle_spawner</span><span class="p">,</span>
    <span class="n">robot_state_publisher</span><span class="p">,</span>
    <span class="n">rviz</span><span class="p">,</span>
    <span class="p">]</span>
<span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">(</span><span class="n">declared_arguments</span> <span class="o">+</span> <span class="n">nodes</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, all defined nodes are grouped in a list that will consistitute the final
launch description.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../02_linux/00_index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Linux and other Utilities</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../02_Packages/00_index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Workspaces and Packages</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; The IDRA team - 2023
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Simulation Setup</a><ul>
<li><a class="reference internal" href="#node-description">Node description</a></li>
<li><a class="reference internal" href="#launch-file">Launch file</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    </body>
</html>