<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>ROS2 simulation interface - IDRA laboratory - Open Knowledge documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">IDRA laboratory - Open Knowledge  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">IDRA laboratory - Open Knowledge  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../01_ros_2/00_index.html">ROS2 Notes</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of ROS2 Notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../01_ros_2/01_CLI/00_index.html">CLI Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../01_ros_2/02_Packages/00_index.html">Workspaces and Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../01_ros_2/10_Simulation/00_index.html">Simulation Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../01_ros_2/30_gazebo/00_index.html">Gazebo Simulator</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../00_index.html">Linux and other Utilities</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Linux and other Utilities</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_docker/00_index.html">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_github_actions/00_index.html">Github Actions for CI/CD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_index.html">Coppelia Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../04_ssh/00_index.html">Fast ssh configuration for GitHub in Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../05_cuda/00_index.html">Nvidia Driver + Cuda Toolkit Installation guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../05_cuda/00_index.html#install-nvidia-drivers-in-ubuntu">Install Nvidia Drivers in Ubuntu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../05_cuda/00_index.html#install-the-nvidia-cuda-toolkit">Install the Nvidia Cuda Toolkit</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="ros2-simulation-interface">
<h1>ROS2 simulation interface<a class="headerlink" href="#ros2-simulation-interface" title="Link to this heading">#</a></h1>
<p>Coppelia does not provide a <em>standard</em> interface with the ROS simulator, but nodes must
be programmed in the Coppelia environment to exchange data.</p>
<p>For this purpose, the preferred scripting language is <a class="reference external" href="https://www.lua.org/">LUA</a>, which
is faster than Python (that’s another alternative in Coppelia).</p>
<p>Scritps are bounded to objects in Coppelia: for this reason it is recommended to write code
that belongs to the object itself, and not to the scene, so that if the entity is copied
and pasted in other projects, the programmed interface is preserved.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To see the list of all available API function, look
<a class="reference external" href="https://www.coppeliarobotics.com/helpFiles/en/apiFunctions.htm">here</a>.</p>
</div>
<section id="robot-simulation">
<span id="coppeliasim-ros2-robot-script"></span><h2>Robot simulation<a class="headerlink" href="#robot-simulation" title="Link to this heading">#</a></h2>
<p>This is an example scritp for a kinematic simulation of a robot in Coppelia that provide
a good understanding of the interface principle. Here the code will be splitted up and
explained in details; the whole script can be found <a class="reference internal" href="02b_robot_interface_example.html#ros2-robot-integration"><span class="std std-ref">here</span></a>.</p>
<p>This is a simple used-defined function that allows to initialize a table with <code class="docutils literal notranslate"><span class="pre">n</span></code> equal
elements <code class="docutils literal notranslate"><span class="pre">value</span></code>; this is useful, as example, for the initialization of the joint handles or maximum
joint properties</p>
<p>Here it is reported the initialization of main variables; <code class="docutils literal notranslate"><span class="pre">q_home</span></code> is the home configuration
of the robot (in the joint space), while <code class="docutils literal notranslate"><span class="pre">joints</span></code> is is a placeholder that will contain
the Coppelia handles of the joints of the robot (i.e. the joint object inside the Coppelia
object tree).
For sake of simplicity, the initial target is set to the home configuration, while joint
limits (for both velocity, acceleration and jerk) are initialized to values that are
constant for all joints.</p>
<p>This function is the callback from the ROS2 subscriber (that will be initialized later);
it takes the desired joint configuration for the system and sets the <code class="docutils literal notranslate"><span class="pre">target</span></code> accordingly.
The <code class="docutils literal notranslate"><span class="pre">msg_received</span></code> boolean flag is used to assert when a new correct message is arrived.
After processing of during the actuation step of the simulation, the flag will be set to <code class="docutils literal notranslate"><span class="pre">false</span></code> again.</p>
<p>This function implements the interface with coppelia that sets the target joint configuration
for the kinematic simulation of the robot. The <code class="docutils literal notranslate"><span class="pre">handles</span></code> are the joints that are commanded
with the specified joint limits. Internally the function collects the current state of
the robot (i.e. joint position and velocity) and calls the built-in <code class="docutils literal notranslate"><span class="pre">sim.moveToConfig</span></code>
<a class="reference external" href="https://www.coppeliarobotics.com/helpFiles/en/regularApi/simMoveToConfig.htm">documented here</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">mov_callback</span></code> function is the callback that processes the result of the <code class="docutils literal notranslate"><span class="pre">sim.moveToConfig</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sysCall_init</span></code> function is the initialization function that is called automatically
by Coppelia at the beginning of the simulation, thus is used to initialize different elements.</p>
<p>In this case a ROS2 topic subscriber and publisher are initialized; the former reads
the desired joint configuration (that’s actually computer by a ROS controller) while the
latter publishes the current joint configuration of the robot.</p>
<p>Then, the <code class="docutils literal notranslate"><span class="pre">joints</span></code> handler are initialized by binding the associated Coppelia objects.
Furthermore, the robot is initially commanded to reach the home configuration.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sysCall_actuation</span></code> is the function that is called at each actuation step of the
simulation. In this case it checks if a new target position has been received from the
publisher and, if so, it calls the <code class="docutils literal notranslate"><span class="pre">move_to_config</span></code> function to update the simulation
target state.</p>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">sysCall_sensing</span></code> function is called at each sensing step of the simulation;
in this case it reads the current joint configuration and publishes it to the ROS2 topic
as defined in the initialization.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; The IDRA team - 2023
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">ROS2 simulation interface</a><ul>
<li><a class="reference internal" href="#robot-simulation">Robot simulation</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    </body>
</html>